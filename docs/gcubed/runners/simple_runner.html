<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>gcubed.runners.simple_runner API documentation</title>
<meta name="description" content="Contains the Runner class - used to run simple model experiments." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>gcubed.runners.simple_runner</code></h1>
</header>
<section id="section-intro">
<p>Contains the Runner class - used to run simple model experiments.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Contains the Runner class - used to run simple model experiments.
&#34;&#34;&#34;
import os
import logging
from datetime import datetime
from gcubed.base import Base
from gcubed.model_configuration import ModelConfiguration
from gcubed.model import Model
from gcubed.linearisation.linear_model import LinearModel
from gcubed.linearisation.state_space_form import StateSpaceForm
from gcubed.linearisation.stable_manifold import StableManifold
from gcubed.projections.projections import Projections
from gcubed.projections.baseline_projections import BaselineProjections
from gcubed.projections.simulation_experiment import SimulationExperiment
from gcubed.projections.simulation_layer import SimulationLayer

class SimpleRunner(Base):
    &#34;&#34;&#34;
    ### Overview

    The Runner class runs a simulation experiment 
    with G-Cubed.

    1. The model is loaded and used to generate baseline projections.
    2. The experiment design is loaded, setting out each of the events being
    simulated as a separate simulation layer.
    3. The simulation layers are loaded and applied to the model to generate 
    projection updates. 
    
    Projections based on any of the simulation layers can be compared to projections
    from the baseline or from other simulation layers associated with the experiment.

    #### Example code to use the simple runner

    Assuming your current working directory is the model root directory, the simple runner
    can be used with the following code.

    ```
    from gcubed.runners.simple_runner import SimpleRunner
    runner: SimpleRunner = SimpleRunner(
        working_directory=&#34;.&#34;,
        configuration_file=&#34;configuration2R164.csv&#34;, 
        experiment_design_file=&#34;experiment1/design.csv&#34;
        )
    runner.run()
    ```

    This assumes that the model configuration file is
    called `configuration2R164.csv`. It also assumes that the simulation experiment is 
    described by the design.csv file that is contained in the `design.csv` file
    that is located in the `simulations/experiment1` subdirectory of the model&#39;s root
    directory.

    After a successful run, if the `SimpleRunner.save_results` = `True`, 
    you will see the results generated in a new timestamped results 
    subdirectory of the directory that you ran the command from.
    
    The results directory contains three CSV files and a log file:

    * `baseline_projections.csv` 
    * `deviation_projections.csv`
    * `final_projections.csv`
    * `run.log`

    #### Note: Determine behaviour with regard to neutral real interest rates
    by setting the `SimpleRunner.linearise_around_the_neutral_real_interest_rate` and
    the `SimpleRunner.start_projections_from_the_neutral_real_interest_rate` properties
    before triggering the model run by calling `SimpleRunner.run`. The default
    behaviour is to:
    
    * use neutral real interest rates for linearisation and
    * start the projections from the neutral real interest rate.

    &#34;&#34;&#34;

    def __init__(self, working_directory:str, configuration_file: str, experiment_design_file: str = None):
        &#34;&#34;&#34;

        ### Overview

        Loads the configuration and the model, ready for running. Call the run method
        when you are ready to start model linearisation etc.

        ### Arguments
        
        `working_directory`: The directory where the results and logs are to be stored.

        `configuration_file`: The location of the configuration file, as an absolute path or relative to the 
        specified working directory.

        `experiment_design_file`: The optional location of the experiment design CSV file, as a relative path directory
        to the experiment design file from the simulations directory within the model directory (the model directory contains
        the configuration file). If the experiment design file is not specified then the run just produces baseline 
        projections.

        use_neutral_real_interest_rate: If `True` then the neutral real interest rate is used in the model, otherwise
        the real interest rates are based on the database values. This parameter is optional and defaults to
        a value of `True`.

        &#34;&#34;&#34;

        self.save_results = False

        if not os.path.isdir(working_directory):
            raise Exception(f&#34;{working_directory} is not a directory.&#34;)
        
        if not os.access(working_directory, os.W_OK):
            raise Exception(f&#34;You need write access to {working_directory} but that permission has not been granted to you.&#34;)

        # Set up defaults for the linearisation and the starting projection values for interest rates.
        self.linearise_around_the_neutral_real_interest_rate = True
        self.start_projections_from_the_neutral_real_interest_rate = True

        # Get the absolute path to the model configuration file.
        if os.path.isabs(configuration_file):
            self.filename:str = configuration_file
        else:
            self.filename: str = os.path.join(working_directory, configuration_file)
        if not os.path.isfile(self.filename):
            raise Exception(f&#34;There is no model configuration file at {self.filename}.&#34;)
        logging.info(f&#34;The model configuration will be loaded from {self.filename}.&#34;)

        # Load the model
        model_configuration: ModelConfiguration = ModelConfiguration(configuration_file=self.filename)
        self._model: Model = Model(model_configuration)

        # Save the working directory for later use.
        self._working_directory = working_directory

        # Save the experiment design file for later use.
        self._experiment_design_file = experiment_design_file

    @property
    def model(self) -&gt; ModelConfiguration:
        &#34;&#34;&#34;
        The model being run.
        &#34;&#34;&#34;
        return self._model

    @property
    def baseline_projections(self) -&gt; BaselineProjections:
        &#34;&#34;&#34;
        The baseline projections.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_baseline_projections&#34;):
            raise Exception(&#34;The baseline projections are not yet available. Make sure you run the model before accessing them.&#34;)
        return self._baseline_projections
    
    @property
    def final_projections(self) -&gt; Projections: 
        &#34;&#34;&#34;
        The final projections or `None` if there was no simulation experiment to do.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_experiment&#34;):
            logging.warning(&#34;The final projections are not yet available. Make sure you run the model to completion before accessing them.&#34;)
            return None
        return self.experiment.final_projections

    @property
    def experiment(self) -&gt; SimulationExperiment:
        &#34;&#34;&#34;
        The simulation experiment.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_experiment&#34;):
            raise Exception(&#34;The simulation experiment results are not yet available. Make sure you run the model before accessing them.&#34;)
        return self._experiment
    
    @property
    def save_results(self) -&gt; bool:
        &#34;&#34;&#34;
        True if the results are to be saved to a results directory automatically at the end of the
        run and false otherwise. 
        
        Defaults to False.

        If necessary, modify this setting once the running is instantiated but 
        before the experiment is run.
        &#34;&#34;&#34;
        return self._save_results

    @save_results.setter
    def save_results(self, value: bool):
        &#34;&#34;&#34;
        Set to True if the results are to be saved to a results 
        directory automatically at the end of the
        run and false otherwise. 
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._save_results = value
    
    @property
    def linearise_around_the_neutral_real_interest_rate(self) -&gt; bool:
        &#34;&#34;&#34;
        `True` if the baseline linearisation is around the neutral real interest rate
        and `False` if it is around database values.
        &#34;&#34;&#34;
        return self._linearise_around_the_neutral_real_interest_rate
    
    @linearise_around_the_neutral_real_interest_rate.setter
    def linearise_around_the_neutral_real_interest_rate(self, value: bool):
        &#34;&#34;&#34;
        Set to `True` if the baseline linearisation is around the neutral real interest rate
        and `False` if it is around database values.
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._linearise_around_the_neutral_real_interest_rate = value

    @property
    def start_projections_from_the_neutral_real_interest_rate(self) -&gt; bool:
        &#34;&#34;&#34;
        `True` if the baseline linearisation is around neutral real interest rates
        and `False` if they are around database values.
        &#34;&#34;&#34;
        return self._start_projections_from_the_neutral_real_interest_rate
    
    @start_projections_from_the_neutral_real_interest_rate.setter
    def start_projections_from_the_neutral_real_interest_rate(self, value: bool):
        &#34;&#34;&#34;
        Set to `True` if the baseline projections start with neutral real interest rate
        and `False` if they start with database values.
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._start_projections_from_the_neutral_real_interest_rate = value

    def run(self):
        &#34;&#34;&#34;
        ### Overview

        Do the actual work of running the model and performing 
        the experiment.
        
        Call this method after creating a Runner instance.

        Once the experiment has run, you can retrieve projections from
        the simulation layer(s) of interest and the baseline for comparison and
        analysis purposes.
        &#34;&#34;&#34;

        if self.save_results:
            # Set up directory where results will be stored
            self._timestamp: str = self.now
            experiment_name = os.path.dirname(self._experiment_design_file)
            self.results_directory: str = os.path.join(self._working_directory, &#34;simulations&#34;, experiment_name, f&#34;results_{self._timestamp}&#34;)
            if not os.path.exists(self.results_directory):
                os.mkdir(self.results_directory)
            if not os.path.isdir(self.results_directory):
                raise Exception(f&#34;Results are to be stored in the directory {self.results_directory} but it is a file, not a directory.&#34;)

        if self.save_results:
            log_file: str = os.path.join(self.results_directory, &#34;run.log&#34;)
            fh = logging.FileHandler(log_file, mode=&#39;w&#39;)
            logging.basicConfig(level=logging.DEBUG,
                                format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                                handlers=[
                                    fh,
                                    logging.StreamHandler()
                                ])
            logging.info(f&#34;Saving results and logs to {self.results_directory}.&#34;)
        else:
            logging.basicConfig(level=logging.DEBUG,
                                format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                                handlers=[
                                    logging.StreamHandler()
                                ])
            logging.info(f&#34;Only logging to the console. No results being saved to files.&#34;)

        # Get the model stable manifold and related results
        linear_model: LinearModel = LinearModel(
            model=self.model, 
            use_neutral_real_interest_rate=self.linearise_around_the_neutral_real_interest_rate)
        state_space_form: StateSpaceForm = StateSpaceForm(linear_model=linear_model)
        stable_manifold: StableManifold = StableManifold(state_space_form=state_space_form)

        # Generate the baseline projections
        self._baseline_projections: BaselineProjections = BaselineProjections(
            stable_manifold=stable_manifold, 
            start_from_neutral_real_interest_rate=self.start_projections_from_the_neutral_real_interest_rate)

        # Generate the CSV file containing baseline projections
        if self.save_results:
            self.baseline_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/baseline_projections.csv&#34;)
            logging.info(f&#34;Baseline publication projections have been saved to a CSV file in {self.results_directory}&#34;)

        if self._experiment_design_file is not None:

            # Run the simulation experiment
            self._experiment = SimulationExperiment(baseline_projections=self.baseline_projections, design_file=self._experiment_design_file)

            if self.save_results:
                # Generate the CSV file containing simulation projections
                self.final_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/final_projections.csv&#34;)
                # Generate the CSV file containing the simulation deviation from baseline projections
                Projections.get_differences_between_projections(new_projections=self.final_projections.publishable_projections, original_projections=self.baseline_projections.publishable_projections).to_csv(f&#34;{self.results_directory}/deviation_projections.csv&#34;)
                logging.info(f&#34;The simulation experiment results have been saved as CSV files in {self.results_directory}&#34;)
            else:
                logging.info(f&#34;The simulation experiment has run.&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="gcubed.runners.simple_runner.SimpleRunner"><code class="flex name class">
<span>class <span class="ident">SimpleRunner</span></span>
<span>(</span><span>working_directory: str, configuration_file: str, experiment_design_file: str = None)</span>
</code></dt>
<dd>
<div class="desc"><h3 id="overview">Overview</h3>
<p>The Runner class runs a simulation experiment
with G-Cubed.</p>
<ol>
<li>The model is loaded and used to generate baseline projections.</li>
<li>The experiment design is loaded, setting out each of the events being
simulated as a separate simulation layer.</li>
<li>The simulation layers are loaded and applied to the model to generate
projection updates. </li>
</ol>
<p>Projections based on any of the simulation layers can be compared to projections
from the baseline or from other simulation layers associated with the experiment.</p>
<h4 id="example-code-to-use-the-simple-runner">Example code to use the simple runner</h4>
<p>Assuming your current working directory is the model root directory, the simple runner
can be used with the following code.</p>
<pre><code>from gcubed.runners.simple_runner import SimpleRunner
runner: SimpleRunner = SimpleRunner(
    working_directory=&quot;.&quot;,
    configuration_file=&quot;configuration2R164.csv&quot;, 
    experiment_design_file=&quot;experiment1/design.csv&quot;
    )
runner.run()
</code></pre>
<p>This assumes that the model configuration file is
called <code>configuration2R164.csv</code>. It also assumes that the simulation experiment is
described by the design.csv file that is contained in the <code>design.csv</code> file
that is located in the <code>simulations/experiment1</code> subdirectory of the model's root
directory.</p>
<p>After a successful run, if the <code><a title="gcubed.runners.simple_runner.SimpleRunner.save_results" href="#gcubed.runners.simple_runner.SimpleRunner.save_results">SimpleRunner.save_results</a></code> = <code>True</code>,
you will see the results generated in a new timestamped results
subdirectory of the directory that you ran the command from.</p>
<p>The results directory contains three CSV files and a log file:</p>
<ul>
<li><code>baseline_projections.csv</code> </li>
<li><code>deviation_projections.csv</code></li>
<li><code>final_projections.csv</code></li>
<li><code>run.log</code></li>
</ul>
<h4 id="note-determine-behaviour-with-regard-to-neutral-real-interest-rates">Note: Determine behaviour with regard to neutral real interest rates</h4>
<p>by setting the <code><a title="gcubed.runners.simple_runner.SimpleRunner.linearise_around_the_neutral_real_interest_rate" href="#gcubed.runners.simple_runner.SimpleRunner.linearise_around_the_neutral_real_interest_rate">SimpleRunner.linearise_around_the_neutral_real_interest_rate</a></code> and
the <code><a title="gcubed.runners.simple_runner.SimpleRunner.start_projections_from_the_neutral_real_interest_rate" href="#gcubed.runners.simple_runner.SimpleRunner.start_projections_from_the_neutral_real_interest_rate">SimpleRunner.start_projections_from_the_neutral_real_interest_rate</a></code> properties
before triggering the model run by calling <code><a title="gcubed.runners.simple_runner.SimpleRunner.run" href="#gcubed.runners.simple_runner.SimpleRunner.run">SimpleRunner.run()</a></code>. The default
behaviour is to:</p>
<ul>
<li>use neutral real interest rates for linearisation and</li>
<li>start the projections from the neutral real interest rate.</li>
</ul>
<h3 id="overview_1">Overview</h3>
<p>Loads the configuration and the model, ready for running. Call the run method
when you are ready to start model linearisation etc.</p>
<h3 id="arguments">Arguments</h3>
<p><code>working_directory</code>: The directory where the results and logs are to be stored.</p>
<p><code>configuration_file</code>: The location of the configuration file, as an absolute path or relative to the
specified working directory.</p>
<p><code>experiment_design_file</code>: The optional location of the experiment design CSV file, as a relative path directory
to the experiment design file from the simulations directory within the model directory (the model directory contains
the configuration file). If the experiment design file is not specified then the run just produces baseline
projections.</p>
<p>use_neutral_real_interest_rate: If <code>True</code> then the neutral real interest rate is used in the model, otherwise
the real interest rates are based on the database values. This parameter is optional and defaults to
a value of <code>True</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SimpleRunner(Base):
    &#34;&#34;&#34;
    ### Overview

    The Runner class runs a simulation experiment 
    with G-Cubed.

    1. The model is loaded and used to generate baseline projections.
    2. The experiment design is loaded, setting out each of the events being
    simulated as a separate simulation layer.
    3. The simulation layers are loaded and applied to the model to generate 
    projection updates. 
    
    Projections based on any of the simulation layers can be compared to projections
    from the baseline or from other simulation layers associated with the experiment.

    #### Example code to use the simple runner

    Assuming your current working directory is the model root directory, the simple runner
    can be used with the following code.

    ```
    from gcubed.runners.simple_runner import SimpleRunner
    runner: SimpleRunner = SimpleRunner(
        working_directory=&#34;.&#34;,
        configuration_file=&#34;configuration2R164.csv&#34;, 
        experiment_design_file=&#34;experiment1/design.csv&#34;
        )
    runner.run()
    ```

    This assumes that the model configuration file is
    called `configuration2R164.csv`. It also assumes that the simulation experiment is 
    described by the design.csv file that is contained in the `design.csv` file
    that is located in the `simulations/experiment1` subdirectory of the model&#39;s root
    directory.

    After a successful run, if the `SimpleRunner.save_results` = `True`, 
    you will see the results generated in a new timestamped results 
    subdirectory of the directory that you ran the command from.
    
    The results directory contains three CSV files and a log file:

    * `baseline_projections.csv` 
    * `deviation_projections.csv`
    * `final_projections.csv`
    * `run.log`

    #### Note: Determine behaviour with regard to neutral real interest rates
    by setting the `SimpleRunner.linearise_around_the_neutral_real_interest_rate` and
    the `SimpleRunner.start_projections_from_the_neutral_real_interest_rate` properties
    before triggering the model run by calling `SimpleRunner.run`. The default
    behaviour is to:
    
    * use neutral real interest rates for linearisation and
    * start the projections from the neutral real interest rate.

    &#34;&#34;&#34;

    def __init__(self, working_directory:str, configuration_file: str, experiment_design_file: str = None):
        &#34;&#34;&#34;

        ### Overview

        Loads the configuration and the model, ready for running. Call the run method
        when you are ready to start model linearisation etc.

        ### Arguments
        
        `working_directory`: The directory where the results and logs are to be stored.

        `configuration_file`: The location of the configuration file, as an absolute path or relative to the 
        specified working directory.

        `experiment_design_file`: The optional location of the experiment design CSV file, as a relative path directory
        to the experiment design file from the simulations directory within the model directory (the model directory contains
        the configuration file). If the experiment design file is not specified then the run just produces baseline 
        projections.

        use_neutral_real_interest_rate: If `True` then the neutral real interest rate is used in the model, otherwise
        the real interest rates are based on the database values. This parameter is optional and defaults to
        a value of `True`.

        &#34;&#34;&#34;

        self.save_results = False

        if not os.path.isdir(working_directory):
            raise Exception(f&#34;{working_directory} is not a directory.&#34;)
        
        if not os.access(working_directory, os.W_OK):
            raise Exception(f&#34;You need write access to {working_directory} but that permission has not been granted to you.&#34;)

        # Set up defaults for the linearisation and the starting projection values for interest rates.
        self.linearise_around_the_neutral_real_interest_rate = True
        self.start_projections_from_the_neutral_real_interest_rate = True

        # Get the absolute path to the model configuration file.
        if os.path.isabs(configuration_file):
            self.filename:str = configuration_file
        else:
            self.filename: str = os.path.join(working_directory, configuration_file)
        if not os.path.isfile(self.filename):
            raise Exception(f&#34;There is no model configuration file at {self.filename}.&#34;)
        logging.info(f&#34;The model configuration will be loaded from {self.filename}.&#34;)

        # Load the model
        model_configuration: ModelConfiguration = ModelConfiguration(configuration_file=self.filename)
        self._model: Model = Model(model_configuration)

        # Save the working directory for later use.
        self._working_directory = working_directory

        # Save the experiment design file for later use.
        self._experiment_design_file = experiment_design_file

    @property
    def model(self) -&gt; ModelConfiguration:
        &#34;&#34;&#34;
        The model being run.
        &#34;&#34;&#34;
        return self._model

    @property
    def baseline_projections(self) -&gt; BaselineProjections:
        &#34;&#34;&#34;
        The baseline projections.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_baseline_projections&#34;):
            raise Exception(&#34;The baseline projections are not yet available. Make sure you run the model before accessing them.&#34;)
        return self._baseline_projections
    
    @property
    def final_projections(self) -&gt; Projections: 
        &#34;&#34;&#34;
        The final projections or `None` if there was no simulation experiment to do.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_experiment&#34;):
            logging.warning(&#34;The final projections are not yet available. Make sure you run the model to completion before accessing them.&#34;)
            return None
        return self.experiment.final_projections

    @property
    def experiment(self) -&gt; SimulationExperiment:
        &#34;&#34;&#34;
        The simulation experiment.
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_experiment&#34;):
            raise Exception(&#34;The simulation experiment results are not yet available. Make sure you run the model before accessing them.&#34;)
        return self._experiment
    
    @property
    def save_results(self) -&gt; bool:
        &#34;&#34;&#34;
        True if the results are to be saved to a results directory automatically at the end of the
        run and false otherwise. 
        
        Defaults to False.

        If necessary, modify this setting once the running is instantiated but 
        before the experiment is run.
        &#34;&#34;&#34;
        return self._save_results

    @save_results.setter
    def save_results(self, value: bool):
        &#34;&#34;&#34;
        Set to True if the results are to be saved to a results 
        directory automatically at the end of the
        run and false otherwise. 
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._save_results = value
    
    @property
    def linearise_around_the_neutral_real_interest_rate(self) -&gt; bool:
        &#34;&#34;&#34;
        `True` if the baseline linearisation is around the neutral real interest rate
        and `False` if it is around database values.
        &#34;&#34;&#34;
        return self._linearise_around_the_neutral_real_interest_rate
    
    @linearise_around_the_neutral_real_interest_rate.setter
    def linearise_around_the_neutral_real_interest_rate(self, value: bool):
        &#34;&#34;&#34;
        Set to `True` if the baseline linearisation is around the neutral real interest rate
        and `False` if it is around database values.
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._linearise_around_the_neutral_real_interest_rate = value

    @property
    def start_projections_from_the_neutral_real_interest_rate(self) -&gt; bool:
        &#34;&#34;&#34;
        `True` if the baseline linearisation is around neutral real interest rates
        and `False` if they are around database values.
        &#34;&#34;&#34;
        return self._start_projections_from_the_neutral_real_interest_rate
    
    @start_projections_from_the_neutral_real_interest_rate.setter
    def start_projections_from_the_neutral_real_interest_rate(self, value: bool):
        &#34;&#34;&#34;
        Set to `True` if the baseline projections start with neutral real interest rate
        and `False` if they start with database values.
        &#34;&#34;&#34;
        assert value is not None
        assert isinstance(value, bool)
        self._start_projections_from_the_neutral_real_interest_rate = value

    def run(self):
        &#34;&#34;&#34;
        ### Overview

        Do the actual work of running the model and performing 
        the experiment.
        
        Call this method after creating a Runner instance.

        Once the experiment has run, you can retrieve projections from
        the simulation layer(s) of interest and the baseline for comparison and
        analysis purposes.
        &#34;&#34;&#34;

        if self.save_results:
            # Set up directory where results will be stored
            self._timestamp: str = self.now
            experiment_name = os.path.dirname(self._experiment_design_file)
            self.results_directory: str = os.path.join(self._working_directory, &#34;simulations&#34;, experiment_name, f&#34;results_{self._timestamp}&#34;)
            if not os.path.exists(self.results_directory):
                os.mkdir(self.results_directory)
            if not os.path.isdir(self.results_directory):
                raise Exception(f&#34;Results are to be stored in the directory {self.results_directory} but it is a file, not a directory.&#34;)

        if self.save_results:
            log_file: str = os.path.join(self.results_directory, &#34;run.log&#34;)
            fh = logging.FileHandler(log_file, mode=&#39;w&#39;)
            logging.basicConfig(level=logging.DEBUG,
                                format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                                handlers=[
                                    fh,
                                    logging.StreamHandler()
                                ])
            logging.info(f&#34;Saving results and logs to {self.results_directory}.&#34;)
        else:
            logging.basicConfig(level=logging.DEBUG,
                                format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                                handlers=[
                                    logging.StreamHandler()
                                ])
            logging.info(f&#34;Only logging to the console. No results being saved to files.&#34;)

        # Get the model stable manifold and related results
        linear_model: LinearModel = LinearModel(
            model=self.model, 
            use_neutral_real_interest_rate=self.linearise_around_the_neutral_real_interest_rate)
        state_space_form: StateSpaceForm = StateSpaceForm(linear_model=linear_model)
        stable_manifold: StableManifold = StableManifold(state_space_form=state_space_form)

        # Generate the baseline projections
        self._baseline_projections: BaselineProjections = BaselineProjections(
            stable_manifold=stable_manifold, 
            start_from_neutral_real_interest_rate=self.start_projections_from_the_neutral_real_interest_rate)

        # Generate the CSV file containing baseline projections
        if self.save_results:
            self.baseline_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/baseline_projections.csv&#34;)
            logging.info(f&#34;Baseline publication projections have been saved to a CSV file in {self.results_directory}&#34;)

        if self._experiment_design_file is not None:

            # Run the simulation experiment
            self._experiment = SimulationExperiment(baseline_projections=self.baseline_projections, design_file=self._experiment_design_file)

            if self.save_results:
                # Generate the CSV file containing simulation projections
                self.final_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/final_projections.csv&#34;)
                # Generate the CSV file containing the simulation deviation from baseline projections
                Projections.get_differences_between_projections(new_projections=self.final_projections.publishable_projections, original_projections=self.baseline_projections.publishable_projections).to_csv(f&#34;{self.results_directory}/deviation_projections.csv&#34;)
                logging.info(f&#34;The simulation experiment results have been saved as CSV files in {self.results_directory}&#34;)
            else:
                logging.info(f&#34;The simulation experiment has run.&#34;)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="gcubed.base.Base" href="../base.html#gcubed.base.Base">Base</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="gcubed.runners.simple_runner.SimpleRunner.baseline_projections"><code class="name">var <span class="ident">baseline_projections</span> : <a title="gcubed.projections.baseline_projections.BaselineProjections" href="../projections/baseline_projections.html#gcubed.projections.baseline_projections.BaselineProjections">BaselineProjections</a></code></dt>
<dd>
<div class="desc"><p>The baseline projections.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def baseline_projections(self) -&gt; BaselineProjections:
    &#34;&#34;&#34;
    The baseline projections.
    &#34;&#34;&#34;
    if not hasattr(self, &#34;_baseline_projections&#34;):
        raise Exception(&#34;The baseline projections are not yet available. Make sure you run the model before accessing them.&#34;)
    return self._baseline_projections</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.experiment"><code class="name">var <span class="ident">experiment</span> : <a title="gcubed.projections.simulation_experiment.SimulationExperiment" href="../projections/simulation_experiment.html#gcubed.projections.simulation_experiment.SimulationExperiment">SimulationExperiment</a></code></dt>
<dd>
<div class="desc"><p>The simulation experiment.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def experiment(self) -&gt; SimulationExperiment:
    &#34;&#34;&#34;
    The simulation experiment.
    &#34;&#34;&#34;
    if not hasattr(self, &#34;_experiment&#34;):
        raise Exception(&#34;The simulation experiment results are not yet available. Make sure you run the model before accessing them.&#34;)
    return self._experiment</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.final_projections"><code class="name">var <span class="ident">final_projections</span> : <a title="gcubed.projections.projections.Projections" href="../projections/projections.html#gcubed.projections.projections.Projections">Projections</a></code></dt>
<dd>
<div class="desc"><p>The final projections or <code>None</code> if there was no simulation experiment to do.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def final_projections(self) -&gt; Projections: 
    &#34;&#34;&#34;
    The final projections or `None` if there was no simulation experiment to do.
    &#34;&#34;&#34;
    if not hasattr(self, &#34;_experiment&#34;):
        logging.warning(&#34;The final projections are not yet available. Make sure you run the model to completion before accessing them.&#34;)
        return None
    return self.experiment.final_projections</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.linearise_around_the_neutral_real_interest_rate"><code class="name">var <span class="ident">linearise_around_the_neutral_real_interest_rate</span> : bool</code></dt>
<dd>
<div class="desc"><p><code>True</code> if the baseline linearisation is around the neutral real interest rate
and <code>False</code> if it is around database values.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def linearise_around_the_neutral_real_interest_rate(self) -&gt; bool:
    &#34;&#34;&#34;
    `True` if the baseline linearisation is around the neutral real interest rate
    and `False` if it is around database values.
    &#34;&#34;&#34;
    return self._linearise_around_the_neutral_real_interest_rate</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.model"><code class="name">var <span class="ident">model</span> : <a title="gcubed.model_configuration.ModelConfiguration" href="../model_configuration.html#gcubed.model_configuration.ModelConfiguration">ModelConfiguration</a></code></dt>
<dd>
<div class="desc"><p>The model being run.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def model(self) -&gt; ModelConfiguration:
    &#34;&#34;&#34;
    The model being run.
    &#34;&#34;&#34;
    return self._model</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.save_results"><code class="name">var <span class="ident">save_results</span> : bool</code></dt>
<dd>
<div class="desc"><p>True if the results are to be saved to a results directory automatically at the end of the
run and false otherwise. </p>
<p>Defaults to False.</p>
<p>If necessary, modify this setting once the running is instantiated but
before the experiment is run.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def save_results(self) -&gt; bool:
    &#34;&#34;&#34;
    True if the results are to be saved to a results directory automatically at the end of the
    run and false otherwise. 
    
    Defaults to False.

    If necessary, modify this setting once the running is instantiated but 
    before the experiment is run.
    &#34;&#34;&#34;
    return self._save_results</code></pre>
</details>
</dd>
<dt id="gcubed.runners.simple_runner.SimpleRunner.start_projections_from_the_neutral_real_interest_rate"><code class="name">var <span class="ident">start_projections_from_the_neutral_real_interest_rate</span> : bool</code></dt>
<dd>
<div class="desc"><p><code>True</code> if the baseline linearisation is around neutral real interest rates
and <code>False</code> if they are around database values.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def start_projections_from_the_neutral_real_interest_rate(self) -&gt; bool:
    &#34;&#34;&#34;
    `True` if the baseline linearisation is around neutral real interest rates
    and `False` if they are around database values.
    &#34;&#34;&#34;
    return self._start_projections_from_the_neutral_real_interest_rate</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="gcubed.runners.simple_runner.SimpleRunner.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><h3 id="overview">Overview</h3>
<p>Do the actual work of running the model and performing
the experiment.</p>
<p>Call this method after creating a Runner instance.</p>
<p>Once the experiment has run, you can retrieve projections from
the simulation layer(s) of interest and the baseline for comparison and
analysis purposes.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
    &#34;&#34;&#34;
    ### Overview

    Do the actual work of running the model and performing 
    the experiment.
    
    Call this method after creating a Runner instance.

    Once the experiment has run, you can retrieve projections from
    the simulation layer(s) of interest and the baseline for comparison and
    analysis purposes.
    &#34;&#34;&#34;

    if self.save_results:
        # Set up directory where results will be stored
        self._timestamp: str = self.now
        experiment_name = os.path.dirname(self._experiment_design_file)
        self.results_directory: str = os.path.join(self._working_directory, &#34;simulations&#34;, experiment_name, f&#34;results_{self._timestamp}&#34;)
        if not os.path.exists(self.results_directory):
            os.mkdir(self.results_directory)
        if not os.path.isdir(self.results_directory):
            raise Exception(f&#34;Results are to be stored in the directory {self.results_directory} but it is a file, not a directory.&#34;)

    if self.save_results:
        log_file: str = os.path.join(self.results_directory, &#34;run.log&#34;)
        fh = logging.FileHandler(log_file, mode=&#39;w&#39;)
        logging.basicConfig(level=logging.DEBUG,
                            format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                            handlers=[
                                fh,
                                logging.StreamHandler()
                            ])
        logging.info(f&#34;Saving results and logs to {self.results_directory}.&#34;)
    else:
        logging.basicConfig(level=logging.DEBUG,
                            format=&#39;%(asctime)s %(levelname)s %(message)s&#39;,
                            handlers=[
                                logging.StreamHandler()
                            ])
        logging.info(f&#34;Only logging to the console. No results being saved to files.&#34;)

    # Get the model stable manifold and related results
    linear_model: LinearModel = LinearModel(
        model=self.model, 
        use_neutral_real_interest_rate=self.linearise_around_the_neutral_real_interest_rate)
    state_space_form: StateSpaceForm = StateSpaceForm(linear_model=linear_model)
    stable_manifold: StableManifold = StableManifold(state_space_form=state_space_form)

    # Generate the baseline projections
    self._baseline_projections: BaselineProjections = BaselineProjections(
        stable_manifold=stable_manifold, 
        start_from_neutral_real_interest_rate=self.start_projections_from_the_neutral_real_interest_rate)

    # Generate the CSV file containing baseline projections
    if self.save_results:
        self.baseline_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/baseline_projections.csv&#34;)
        logging.info(f&#34;Baseline publication projections have been saved to a CSV file in {self.results_directory}&#34;)

    if self._experiment_design_file is not None:

        # Run the simulation experiment
        self._experiment = SimulationExperiment(baseline_projections=self.baseline_projections, design_file=self._experiment_design_file)

        if self.save_results:
            # Generate the CSV file containing simulation projections
            self.final_projections.publishable_projections.to_csv(f&#34;{self.results_directory}/final_projections.csv&#34;)
            # Generate the CSV file containing the simulation deviation from baseline projections
            Projections.get_differences_between_projections(new_projections=self.final_projections.publishable_projections, original_projections=self.baseline_projections.publishable_projections).to_csv(f&#34;{self.results_directory}/deviation_projections.csv&#34;)
            logging.info(f&#34;The simulation experiment results have been saved as CSV files in {self.results_directory}&#34;)
        else:
            logging.info(f&#34;The simulation experiment has run.&#34;)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="gcubed.base.Base" href="../base.html#gcubed.base.Base">Base</a></b></code>:
<ul class="hlist">
<li><code><a title="gcubed.base.Base.get_year_labels" href="../base.html#gcubed.base.Base.get_year_labels">get_year_labels</a></code></li>
<li><code><a title="gcubed.base.Base.load_data" href="../base.html#gcubed.base.Base.load_data">load_data</a></code></li>
<li><code><a title="gcubed.base.Base.now" href="../base.html#gcubed.base.Base.now">now</a></code></li>
<li><code><a title="gcubed.base.Base.zeros" href="../base.html#gcubed.base.Base.zeros">zeros</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="gcubed.runners" href="index.html">gcubed.runners</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="gcubed.runners.simple_runner.SimpleRunner" href="#gcubed.runners.simple_runner.SimpleRunner">SimpleRunner</a></code></h4>
<ul class="">
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.baseline_projections" href="#gcubed.runners.simple_runner.SimpleRunner.baseline_projections">baseline_projections</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.experiment" href="#gcubed.runners.simple_runner.SimpleRunner.experiment">experiment</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.final_projections" href="#gcubed.runners.simple_runner.SimpleRunner.final_projections">final_projections</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.linearise_around_the_neutral_real_interest_rate" href="#gcubed.runners.simple_runner.SimpleRunner.linearise_around_the_neutral_real_interest_rate">linearise_around_the_neutral_real_interest_rate</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.model" href="#gcubed.runners.simple_runner.SimpleRunner.model">model</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.run" href="#gcubed.runners.simple_runner.SimpleRunner.run">run</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.save_results" href="#gcubed.runners.simple_runner.SimpleRunner.save_results">save_results</a></code></li>
<li><code><a title="gcubed.runners.simple_runner.SimpleRunner.start_projections_from_the_neutral_real_interest_rate" href="#gcubed.runners.simple_runner.SimpleRunner.start_projections_from_the_neutral_real_interest_rate">start_projections_from_the_neutral_real_interest_rate</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>